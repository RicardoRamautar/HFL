{"seed": 0, "exp_name": "hfl_client", "config": "custom_imports = dict(\n    imports=[\n        'mmdet3d_plugin.models.detectors.cmt_btsa',\n        'mmdet3d_plugin.models.dense_heads.cmt_btsa_head',\n        'mmdet3d_plugin.datasets.custom_nuscenes_dataset'\n    ],\n    allow_failed_imports=False)\nplugin = True\nplugin_dir = 'projects/mmdet3d_plugin/'\npoint_cloud_range = [-54.0, -54.0, -5.0, 54.0, 54.0, 3.0]\nclass_names = [\n    'car', 'truck', 'construction_vehicle', 'bus', 'trailer', 'barrier',\n    'motorcycle', 'bicycle', 'pedestrian', 'traffic_cone'\n]\nvoxel_size = [0.075, 0.075, 0.2]\nout_size_factor = 8\nnorm_cfg = dict(type='BN', requires_grad=True)\ndataset_type = 'HFLNuScenesBTSA'\ndata_root = '/opt/src/mmdetection3d/data/nuscenes/'\npkl_root = '/tudelft.net/staff-umbrella/rdramautar/datasets/nuscenes_infos/'\ninput_modality = dict(\n    use_lidar=True,\n    use_camera=False,\n    use_radar=False,\n    use_map=False,\n    use_external=False)\ntrain_pipeline = [\n    dict(\n        type='LoadPointsFromFile',\n        coord_type='LIDAR',\n        load_dim=5,\n        use_dim=[0, 1, 2, 3, 4]),\n    dict(\n        type='LoadPointsFromMultiSweeps',\n        sweeps_num=1,\n        use_dim=[0, 1, 2, 3, 4]),\n    dict(type='LoadAnnotations3D', with_bbox_3d=True, with_label_3d=True),\n    dict(\n        type='GlobalRotScaleTrans',\n        rot_range=[-0.785, 0.785],\n        scale_ratio_range=[0.9, 1.1],\n        translation_std=[0.5, 0.5, 0.5]),\n    dict(\n        type='RandomFlip3D',\n        sync_2d=False,\n        flip_ratio_bev_horizontal=0.5,\n        flip_ratio_bev_vertical=0.5),\n    dict(\n        type='PointsRangeFilter',\n        point_cloud_range=[-54.0, -54.0, -5.0, 54.0, 54.0, 3.0]),\n    dict(\n        type='ObjectRangeFilter',\n        point_cloud_range=[-54.0, -54.0, -5.0, 54.0, 54.0, 3.0]),\n    dict(\n        type='ObjectNameFilter',\n        classes=[\n            'car', 'truck', 'construction_vehicle', 'bus', 'trailer',\n            'barrier', 'motorcycle', 'bicycle', 'pedestrian', 'traffic_cone'\n        ]),\n    dict(type='PointShuffle'),\n    dict(\n        type='DefaultFormatBundle3D',\n        class_names=[\n            'car', 'truck', 'construction_vehicle', 'bus', 'trailer',\n            'barrier', 'motorcycle', 'bicycle', 'pedestrian', 'traffic_cone'\n        ]),\n    dict(\n        type='Collect3D',\n        keys=['points', 'gt_bboxes_3d', 'gt_labels_3d'],\n        meta_keys=('filename', 'ori_shape', 'img_shape', 'lidar2img',\n                   'depth2img', 'cam2img', 'pad_shape', 'scale_factor', 'flip',\n                   'pcd_horizontal_flip', 'pcd_vertical_flip', 'box_mode_3d',\n                   'box_type_3d', 'img_norm_cfg', 'pcd_trans', 'sample_idx',\n                   'pcd_scale_factor', 'pcd_rotation', 'pts_filename',\n                   'transformation_3d_flow', 'rot_degree', 'gt_bboxes_3d',\n                   'gt_labels_3d', 'gt_labels_3d', 'ego2global_translation',\n                   'ego2global_rotation', 'prev_idx', 'next_idx',\n                   'scene_token'))\n]\ntest_pipeline = [\n    dict(\n        type='LoadPointsFromFile',\n        coord_type='LIDAR',\n        load_dim=5,\n        use_dim=[0, 1, 2, 3, 4]),\n    dict(\n        type='LoadPointsFromMultiSweeps',\n        sweeps_num=1,\n        use_dim=[0, 1, 2, 3, 4]),\n    dict(\n        type='MultiScaleFlipAug3D',\n        img_scale=(1333, 800),\n        pts_scale_ratio=1,\n        flip=False,\n        transforms=[\n            dict(\n                type='GlobalRotScaleTrans',\n                rot_range=[0, 0],\n                scale_ratio_range=[1.0, 1.0],\n                translation_std=[0, 0, 0]),\n            dict(type='RandomFlip3D'),\n            dict(\n                type='DefaultFormatBundle3D',\n                class_names=[\n                    'car', 'truck', 'construction_vehicle', 'bus', 'trailer',\n                    'barrier', 'motorcycle', 'bicycle', 'pedestrian',\n                    'traffic_cone'\n                ],\n                with_label=False),\n            dict(\n                type='Collect3D',\n                keys=['points'],\n                meta_keys=('filename', 'ori_shape', 'img_shape', 'lidar2img',\n                           'depth2img', 'cam2img', 'pad_shape', 'scale_factor',\n                           'flip', 'pcd_horizontal_flip', 'pcd_vertical_flip',\n                           'box_mode_3d', 'box_type_3d', 'img_norm_cfg',\n                           'pcd_trans', 'sample_idx', 'pcd_scale_factor',\n                           'pcd_rotation', 'pts_filename',\n                           'transformation_3d_flow', 'rot_degree',\n                           'gt_bboxes_3d', 'gt_labels_3d', 'gt_labels_3d',\n                           'ego2global_translation', 'ego2global_rotation',\n                           'prev_idx', 'next_idx', 'scene_token'))\n        ])\n]\ndata = dict(\n    samples_per_gpu=4,\n    workers_per_gpu=6,\n    train=dict(\n        type='HFLNuScenesBTSA',\n        data_root='/opt/src/mmdetection3d/data/nuscenes/',\n        ann_file=\n        '/tudelft.net/staff-umbrella/rdramautar/datasets/nuscenes_infos/nuscenes_infos_train_2.pkl',\n        load_interval=1,\n        pipeline=[\n            dict(\n                type='LoadPointsFromFile',\n                coord_type='LIDAR',\n                load_dim=5,\n                use_dim=[0, 1, 2, 3, 4]),\n            dict(\n                type='LoadPointsFromMultiSweeps',\n                sweeps_num=1,\n                use_dim=[0, 1, 2, 3, 4]),\n            dict(\n                type='LoadAnnotations3D',\n                with_bbox_3d=True,\n                with_label_3d=True),\n            dict(\n                type='GlobalRotScaleTrans',\n                rot_range=[-0.785, 0.785],\n                scale_ratio_range=[0.9, 1.1],\n                translation_std=[0.5, 0.5, 0.5]),\n            dict(\n                type='RandomFlip3D',\n                sync_2d=False,\n                flip_ratio_bev_horizontal=0.5,\n                flip_ratio_bev_vertical=0.5),\n            dict(\n                type='PointsRangeFilter',\n                point_cloud_range=[-54.0, -54.0, -5.0, 54.0, 54.0, 3.0]),\n            dict(\n                type='ObjectRangeFilter',\n                point_cloud_range=[-54.0, -54.0, -5.0, 54.0, 54.0, 3.0]),\n            dict(\n                type='ObjectNameFilter',\n                classes=[\n                    'car', 'truck', 'construction_vehicle', 'bus', 'trailer',\n                    'barrier', 'motorcycle', 'bicycle', 'pedestrian',\n                    'traffic_cone'\n                ]),\n            dict(type='PointShuffle'),\n            dict(\n                type='DefaultFormatBundle3D',\n                class_names=[\n                    'car', 'truck', 'construction_vehicle', 'bus', 'trailer',\n                    'barrier', 'motorcycle', 'bicycle', 'pedestrian',\n                    'traffic_cone'\n                ]),\n            dict(\n                type='Collect3D',\n                keys=['points', 'gt_bboxes_3d', 'gt_labels_3d'],\n                meta_keys=('filename', 'ori_shape', 'img_shape', 'lidar2img',\n                           'depth2img', 'cam2img', 'pad_shape', 'scale_factor',\n                           'flip', 'pcd_horizontal_flip', 'pcd_vertical_flip',\n                           'box_mode_3d', 'box_type_3d', 'img_norm_cfg',\n                           'pcd_trans', 'sample_idx', 'pcd_scale_factor',\n                           'pcd_rotation', 'pts_filename',\n                           'transformation_3d_flow', 'rot_degree',\n                           'gt_bboxes_3d', 'gt_labels_3d', 'gt_labels_3d',\n                           'ego2global_translation', 'ego2global_rotation',\n                           'prev_idx', 'next_idx', 'scene_token'))\n        ],\n        classes=[\n            'car', 'truck', 'construction_vehicle', 'bus', 'trailer',\n            'barrier', 'motorcycle', 'bicycle', 'pedestrian', 'traffic_cone'\n        ],\n        modality=dict(\n            use_lidar=True,\n            use_camera=False,\n            use_radar=False,\n            use_map=False,\n            use_external=False),\n        test_mode=False,\n        box_type_3d='LiDAR',\n        scenes=['scene-0177'],\n        scene_translation=\n        '/tudelft.net/staff-umbrella/rdramautar/HFL/data/scene_name_to_token.json',\n        enable_hfl=True),\n    val=dict(\n        type='HFLNuScenesBTSA',\n        data_root='/opt/src/mmdetection3d/data/nuscenes/',\n        ann_file=\n        '/tudelft.net/staff-umbrella/rdramautar/datasets/nuscenes_infos/nuscenes_infos_val_2.pkl',\n        load_interval=1,\n        pipeline=[\n            dict(\n                type='LoadPointsFromFile',\n                coord_type='LIDAR',\n                load_dim=5,\n                use_dim=[0, 1, 2, 3, 4]),\n            dict(\n                type='LoadPointsFromMultiSweeps',\n                sweeps_num=1,\n                use_dim=[0, 1, 2, 3, 4]),\n            dict(\n                type='MultiScaleFlipAug3D',\n                img_scale=(1333, 800),\n                pts_scale_ratio=1,\n                flip=False,\n                transforms=[\n                    dict(\n                        type='GlobalRotScaleTrans',\n                        rot_range=[0, 0],\n                        scale_ratio_range=[1.0, 1.0],\n                        translation_std=[0, 0, 0]),\n                    dict(type='RandomFlip3D'),\n                    dict(\n                        type='DefaultFormatBundle3D',\n                        class_names=[\n                            'car', 'truck', 'construction_vehicle', 'bus',\n                            'trailer', 'barrier', 'motorcycle', 'bicycle',\n                            'pedestrian', 'traffic_cone'\n                        ],\n                        with_label=False),\n                    dict(\n                        type='Collect3D',\n                        keys=['points'],\n                        meta_keys=('filename', 'ori_shape', 'img_shape',\n                                   'lidar2img', 'depth2img', 'cam2img',\n                                   'pad_shape', 'scale_factor', 'flip',\n                                   'pcd_horizontal_flip', 'pcd_vertical_flip',\n                                   'box_mode_3d', 'box_type_3d',\n                                   'img_norm_cfg', 'pcd_trans', 'sample_idx',\n                                   'pcd_scale_factor', 'pcd_rotation',\n                                   'pts_filename', 'transformation_3d_flow',\n                                   'rot_degree', 'gt_bboxes_3d',\n                                   'gt_labels_3d', 'gt_labels_3d',\n                                   'ego2global_translation',\n                                   'ego2global_rotation', 'prev_idx',\n                                   'next_idx', 'scene_token'))\n                ])\n        ],\n        classes=[\n            'car', 'truck', 'construction_vehicle', 'bus', 'trailer',\n            'barrier', 'motorcycle', 'bicycle', 'pedestrian', 'traffic_cone'\n        ],\n        modality=dict(\n            use_lidar=True,\n            use_camera=False,\n            use_radar=False,\n            use_map=False,\n            use_external=False),\n        test_mode=True,\n        box_type_3d='LiDAR'),\n    test=dict(\n        type='HFLNuScenesBTSA',\n        data_root='/opt/src/mmdetection3d/data/nuscenes/',\n        ann_file=\n        '/tudelft.net/staff-umbrella/rdramautar/datasets/nuscenes_infos/nuscenes_infos_val_2.pkl',\n        load_interval=1,\n        pipeline=[\n            dict(\n                type='LoadPointsFromFile',\n                coord_type='LIDAR',\n                load_dim=5,\n                use_dim=[0, 1, 2, 3, 4]),\n            dict(\n                type='LoadPointsFromMultiSweeps',\n                sweeps_num=1,\n                use_dim=[0, 1, 2, 3, 4]),\n            dict(\n                type='MultiScaleFlipAug3D',\n                img_scale=(1333, 800),\n                pts_scale_ratio=1,\n                flip=False,\n                transforms=[\n                    dict(\n                        type='GlobalRotScaleTrans',\n                        rot_range=[0, 0],\n                        scale_ratio_range=[1.0, 1.0],\n                        translation_std=[0, 0, 0]),\n                    dict(type='RandomFlip3D'),\n                    dict(\n                        type='DefaultFormatBundle3D',\n                        class_names=[\n                            'car', 'truck', 'construction_vehicle', 'bus',\n                            'trailer', 'barrier', 'motorcycle', 'bicycle',\n                            'pedestrian', 'traffic_cone'\n                        ],\n                        with_label=False),\n                    dict(\n                        type='Collect3D',\n                        keys=['points'],\n                        meta_keys=('filename', 'ori_shape', 'img_shape',\n                                   'lidar2img', 'depth2img', 'cam2img',\n                                   'pad_shape', 'scale_factor', 'flip',\n                                   'pcd_horizontal_flip', 'pcd_vertical_flip',\n                                   'box_mode_3d', 'box_type_3d',\n                                   'img_norm_cfg', 'pcd_trans', 'sample_idx',\n                                   'pcd_scale_factor', 'pcd_rotation',\n                                   'pts_filename', 'transformation_3d_flow',\n                                   'rot_degree', 'gt_bboxes_3d',\n                                   'gt_labels_3d', 'gt_labels_3d',\n                                   'ego2global_translation',\n                                   'ego2global_rotation', 'prev_idx',\n                                   'next_idx', 'scene_token'))\n                ])\n        ],\n        classes=[\n            'car', 'truck', 'construction_vehicle', 'bus', 'trailer',\n            'barrier', 'motorcycle', 'bicycle', 'pedestrian', 'traffic_cone'\n        ],\n        modality=dict(\n            use_lidar=True,\n            use_camera=False,\n            use_radar=False,\n            use_map=False,\n            use_external=False),\n        test_mode=True,\n        box_type_3d='LiDAR'))\nmodel = dict(\n    type='CmtBtsaDetector',\n    pts_voxel_layer=dict(\n        num_point_features=5,\n        max_num_points=10,\n        voxel_size=[0.075, 0.075, 0.2],\n        max_voxels=(120000, 160000),\n        point_cloud_range=[-54.0, -54.0, -5.0, 54.0, 54.0, 3.0]),\n    pts_voxel_encoder=dict(type='HardSimpleVFE', num_features=5),\n    pts_middle_encoder=dict(\n        type='SparseEncoder',\n        in_channels=5,\n        sparse_shape=[41, 1440, 1440],\n        output_channels=128,\n        order=('conv', 'norm', 'act'),\n        encoder_channels=((16, 16, 32), (32, 32, 64), (64, 64, 128), (128,\n                                                                      128)),\n        encoder_paddings=((0, 0, 1), (0, 0, 1), (0, 0, [0, 1, 1]), (0, 0)),\n        block_type='basicblock'),\n    pts_backbone=dict(\n        type='SECOND',\n        in_channels=256,\n        out_channels=[128, 256],\n        layer_nums=[5, 5],\n        layer_strides=[1, 2],\n        norm_cfg=dict(type='BN', eps=0.001, momentum=0.01),\n        conv_cfg=dict(type='Conv2d', bias=False)),\n    pts_neck=dict(\n        type='SECONDFPN',\n        in_channels=[128, 256],\n        out_channels=[256, 256],\n        upsample_strides=[1, 2],\n        norm_cfg=dict(type='BN', eps=0.001, momentum=0.01),\n        upsample_cfg=dict(type='deconv', bias=False),\n        use_conv_for_no_stride=True),\n    btsa_cfg=dict(\n        embedding_size=512,\n        num_heads=8,\n        num_feat_levels=1,\n        num_sample_points=4,\n        bev_queue_size=3),\n    pts_bbox_head=dict(\n        type='CmtLidarBtsaHead',\n        in_channels=512,\n        hidden_dim=256,\n        downsample_scale=8,\n        common_heads=dict(\n            center=(2, 2), height=(1, 2), dim=(3, 2), rot=(2, 2), vel=(2, 2)),\n        tasks=[\n            dict(\n                num_class=10,\n                class_names=[\n                    'car', 'truck', 'construction_vehicle', 'bus', 'trailer',\n                    'barrier', 'motorcycle', 'bicycle', 'pedestrian',\n                    'traffic_cone'\n                ])\n        ],\n        bbox_coder=dict(\n            type='MultiTaskBBoxCoder',\n            post_center_range=[-61.2, -61.2, -10.0, 61.2, 61.2, 10.0],\n            pc_range=[-54.0, -54.0, -5.0, 54.0, 54.0, 3.0],\n            max_num=300,\n            voxel_size=[0.075, 0.075, 0.2],\n            num_classes=10),\n        separate_head=dict(\n            type='SeparateTaskHead', init_bias=-2.19, final_kernel=3),\n        transformer=dict(\n            type='CmtLidarTransformer',\n            decoder=dict(\n                type='PETRTransformerDecoder',\n                return_intermediate=True,\n                num_layers=6,\n                transformerlayers=dict(\n                    type='PETRTransformerDecoderLayer',\n                    attn_cfgs=[\n                        dict(\n                            type='MultiheadAttention',\n                            embed_dims=256,\n                            num_heads=8,\n                            dropout=0.1),\n                        dict(\n                            type='PETRMultiheadFlashAttention',\n                            embed_dims=256,\n                            num_heads=8,\n                            dropout=0.1)\n                    ],\n                    ffn_cfgs=dict(\n                        type='FFN',\n                        embed_dims=256,\n                        feedforward_channels=1024,\n                        num_fcs=2,\n                        ffn_drop=0.0,\n                        act_cfg=dict(type='ReLU', inplace=True)),\n                    feedforward_channels=1024,\n                    operation_order=('self_attn', 'norm', 'cross_attn', 'norm',\n                                     'ffn', 'norm')))),\n        loss_cls=dict(\n            type='FocalLoss',\n            use_sigmoid=True,\n            gamma=2,\n            alpha=0.25,\n            reduction='mean',\n            loss_weight=2.0),\n        loss_bbox=dict(type='L1Loss', reduction='mean', loss_weight=0.25),\n        loss_heatmap=dict(\n            type='GaussianFocalLoss', reduction='mean', loss_weight=1.0)),\n    train_cfg=dict(\n        pts=dict(\n            dataset='nuScenes',\n            assigner=dict(\n                type='HungarianAssigner3D',\n                cls_cost=dict(type='FocalLossCost', weight=2.0),\n                reg_cost=dict(type='BBox3DL1Cost', weight=0.25),\n                iou_cost=dict(type='IoUCost', weight=0.0),\n                pc_range=[-54.0, -54.0, -5.0, 54.0, 54.0, 3.0],\n                code_weights=[\n                    2.0, 2.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 0.2, 0.2\n                ]),\n            pos_weight=-1,\n            gaussian_overlap=0.1,\n            min_radius=2,\n            grid_size=[1440, 1440, 40],\n            voxel_size=[0.075, 0.075, 0.2],\n            out_size_factor=8,\n            code_weights=[2.0, 2.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 0.2, 0.2],\n            point_cloud_range=[-54.0, -54.0, -5.0, 54.0, 54.0, 3.0])),\n    test_cfg=dict(\n        pts=dict(\n            dataset='nuScenes',\n            grid_size=[1440, 1440, 40],\n            out_size_factor=8,\n            pc_range=[-54.0, -54.0, -5.0, 54.0, 54.0, 3.0],\n            voxel_size=[0.075, 0.075],\n            nms_type=None,\n            nms_thr=0.2,\n            use_rotate_nms=True,\n            max_num=200)))\noptimizer = dict(type='AdamW', lr=0.0001, weight_decay=0.01)\noptimizer_config = dict(\n    type='CustomFp16OptimizerHook',\n    loss_scale='dynamic',\n    grad_clip=dict(max_norm=35, norm_type=2),\n    custom_fp16=dict(\n        pts_voxel_encoder=False, pts_middle_encoder=False,\n        pts_bbox_head=False))\nlr_config = dict(\n    policy='cyclic',\n    target_ratio=(6, 0.0001),\n    cyclic_times=1,\n    step_ratio_up=0.4)\nmomentum_config = dict(\n    policy='cyclic',\n    target_ratio=(0.8947368421052632, 1),\n    cyclic_times=1,\n    step_ratio_up=0.4)\ntotal_epochs = 1\ncheckpoint_config = None\nlog_config = dict(interval=5, hooks=[dict(type='TextLoggerHook')])\ndist_params = dict(backend='nccl')\nlog_level = 'INFO'\nwork_dir = None\nload_from = None\nresume_from = None\nrunner = dict(type='EpochBasedRunner', max_epochs=1)\nworkflow = [('train', 1)]\ngpu_ids = [0]\nevaluation = None\nseed = 0\n"}
{"mode": "train", "epoch": 1, "iter": 5, "lr": 0.0006, "memory": 17637, "data_time": 0.63705, "loss_cls": 0.01366, "loss_bbox": 0.56934, "d0.loss_cls": 0.01242, "d0.loss_bbox": 0.54756, "d1.loss_cls": 0.02867, "d1.loss_bbox": 0.5629, "d2.loss_cls": 0.01495, "d2.loss_bbox": 0.5657, "d3.loss_cls": 0.01363, "d3.loss_bbox": 0.56476, "d4.loss_cls": 0.01315, "d4.loss_bbox": 0.58036, "dn_loss_cls": 0.50645, "dn_loss_bbox": 0.58509, "d0.dn_loss_cls": 0.43824, "d0.dn_loss_bbox": 0.51731, "d1.dn_loss_cls": 0.46416, "d1.dn_loss_bbox": 0.52817, "d2.dn_loss_cls": 0.49185, "d2.dn_loss_bbox": 0.56644, "d3.dn_loss_cls": 0.49485, "d3.dn_loss_bbox": 0.55428, "d4.dn_loss_cls": 0.5062, "d4.dn_loss_bbox": 0.58254, "loss": 9.72269, "grad_norm": NaN, "time": 1.76074}
{"mode": "train", "epoch": 1, "iter": 10, "lr": 4e-05, "memory": 17637, "data_time": 0.01839, "loss_cls": 0.03336, "loss_bbox": 1.28141, "d0.loss_cls": 0.02214, "d0.loss_bbox": 1.08255, "d1.loss_cls": 0.06472, "d1.loss_bbox": 1.14593, "d2.loss_cls": 0.03284, "d2.loss_bbox": 1.21073, "d3.loss_cls": 0.03158, "d3.loss_bbox": 1.25984, "d4.loss_cls": 0.03531, "d4.loss_bbox": 1.30153, "dn_loss_cls": 0.58243, "dn_loss_bbox": 0.98983, "d0.dn_loss_cls": 0.54863, "d0.dn_loss_bbox": 0.89536, "d1.dn_loss_cls": 0.53355, "d1.dn_loss_bbox": 0.85365, "d2.dn_loss_cls": 0.55729, "d2.dn_loss_bbox": 0.94545, "d3.dn_loss_cls": 0.56978, "d3.dn_loss_bbox": 0.98333, "d4.dn_loss_cls": 0.5701, "d4.dn_loss_bbox": 0.98997, "loss": 16.52131, "grad_norm": 141.06553, "time": 1.16056}
